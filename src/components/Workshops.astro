---
// Workshops component - display workshop listings

import { getCollection } from 'astro:content';

// Get all workshops from content collection
const allWorkshops = await getCollection('workshops');

// Sort workshops by sort_index (ascending), then by date (descending)
const workshops = allWorkshops.sort((a, b) => {
  // First sort by sort_index (lower numbers first)
  const indexA = a.data.sort_index ?? Number.MAX_SAFE_INTEGER;
  const indexB = b.data.sort_index ?? Number.MAX_SAFE_INTEGER;
  
  if (indexA !== indexB) {
    return indexA - indexB;
  }
  
  // If sort_index is the same, sort by date (newer first)
  if (!a.data.date || !b.data.date) return 0;
  return new Date(b.data.date).getTime() - new Date(a.data.date).getTime();
});

// Format date for display
function formatDate(dateString: string): string {
  const date = new Date(dateString);
  return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
}
---

<section id="workshops" class="workshops py-section-mobile md:py-section-desktop px-4">
  <div class="max-w-6xl mx-auto">
    <h2 class="text-h2-mobile md:text-h2-desktop font-semibold mb-8 text-secondary text-center">
      Workshops
    </h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {workshops.map((workshop) => (
        <a 
          href={`/workshops/${workshop.slug}`}
          class="workshop-card p-6 rounded-lg bg-surface hover:bg-surface/80 transition-all duration-200 block group"
        >
          <h3 class="text-h3-mobile font-semibold mb-3 text-secondary group-hover:text-primary transition-colors">
            {workshop.data.title}
          </h3>
          <p class="text-text-light text-sm mb-3">
            {workshop.data.description}
          </p>
          <div class="text-xs text-text-light space-y-1">
            <p class="font-medium">{workshop.data.venue}</p>
            <p>{formatDate(workshop.data.date)}</p>
          </div>
        </a>
      ))}
    </div>
  </div>
</section>
